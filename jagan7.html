<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Tracker Pro</title>
    <style>
        :root {
            --accent: #00f2fe; --purple: #892fe2; --success: #00ff88;
            --danger: #ff0055; --warning: #f59e0b; --bg: #080808;
            --card-bg: rgba(255, 255, 255, 0.06);
        }

        body {
            background-color: var(--bg); color: white; font-family: 'Inter', sans-serif;
            margin: 0; min-height: 100vh;
            background: radial-gradient(circle at top right, #1a1a2e, #080808);
        }

        .container { max-width: 480px; margin: auto; padding: 20px; }

        .glass-card {
            background: var(--card-bg); backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 25px;
            padding: 20px; margin-bottom: 20px;
        }

        /* --- PROFILE SECTION --- */
        .profile-header { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
        #u-photo-display { width: 65px; height: 65px; border-radius: 18px; border: 2px solid var(--accent); object-fit: cover; background: #222; }
        .user-info-text h2 { margin: 0; font-size: 1.2rem; color: #fff; }
        .user-info-text p { margin: 2px 0; font-size: 0.75rem; color: var(--accent); opacity: 0.9; }

        /* --- LOGIN FORM --- */
        .photo-upload-label {
            width: 100px; height: 100px; border-radius: 50%; border: 2px dashed var(--accent);
            margin: 0 auto 15px; display: flex; align-items: center; justify-content: center;
            cursor: pointer; overflow: hidden; background: rgba(255,255,255,0.05);
        }
        #preview-img { width: 100%; height: 100%; object-fit: cover; display: none; }

        /* --- STATS --- */
        .ring-container { position: relative; width: 140px; height: 140px; margin: 0 auto; }
        .percentage-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }
        .percentage-text h2 { margin: 0; font-size: 1.8rem; }

        /* --- SUBJECT CARDS --- */
        .subject-card { position: relative; border-left: 4px solid var(--accent); }
        .subject-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .subject-name { font-weight: 800; font-size: 0.95rem; color: #fff; text-transform: uppercase; }
        
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
        .action-btn { border: none; padding: 10px; border-radius: 12px; font-weight: 800; cursor: pointer; transition: 0.2s; font-size: 0.7rem; }
        .btn-p { background: rgba(0, 255, 136, 0.1); color: var(--success); border: 1px solid var(--success); }
        .btn-a { background: rgba(255, 0, 85, 0.1); color: var(--danger); border: 1px solid var(--danger); }
        .btn-b { background: rgba(245, 158, 11, 0.1); color: var(--warning); border: 1px solid var(--warning); }
        
        .prediction { margin-top: 12px; font-size: 0.75rem; color: #aaa; background: rgba(0,0,0,0.2); padding: 8px; border-radius: 8px; }

        input { width: 100%; padding: 14px; margin: 8px 0; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; color: white; box-sizing: border-box; }
        .login-btn { width: 100%; padding: 16px; border-radius: 12px; border: none; background: linear-gradient(45deg, var(--accent), var(--purple)); color: white; font-weight: bold; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div id="login-screen">
        <div class="glass-card" style="text-align: center; margin-top: 30px;">
            <h1 style="margin-bottom: 10px;">Attendance<br><span style="color: var(--accent);">Tracker</span></h1>
            
            <label class="photo-upload-label" for="photo-input">
                <span id="upload-icon">ðŸ“¸</span>
                <img id="preview-img" src="" alt="Preview">
            </label>
            <input type="file" id="photo-input" hidden accept="image/*" onchange="handlePhoto(this)">

            <input type="text" id="nameIn" placeholder="Full Name">
            <input type="text" id="rollIn" placeholder="Roll Number (e.g. 21BECE01)">
            <input type="text" id="secIn" placeholder="Section (e.g. A2 / CSE-1)">
            
            <button class="login-btn" onclick="saveProfile()">ACCESS DASHBOARD</button>
            <p style="color:#555; font-size: 0.7rem; margin-top: 15px;">Success is the sum of small efforts, repeated day-in and day-out.</p>
        </div>
    </div>

    <div id="app-screen" style="display: none;">
        <div class="profile-header">
            <img id="u-photo-display" src="" alt="User">
            <div class="user-info-text">
                <h2 id="u-name-display">Student Name</h2>
                <p id="u-detail-display">Roll No â€¢ Section</p>
            </div>
            <button onclick="logout()" style="margin-left:auto; background:none; border:none; color:var(--danger); font-size:0.65rem; font-weight:bold; cursor:pointer; border: 1px solid var(--danger); padding: 5px 8px; border-radius: 8px;">RESET</button>
        </div>

        <div class="glass-card">
            <div class="ring-container">
                <svg viewBox="0 0 100 100" style="transform: rotate(-90deg);">
                    <circle cx="50" cy="50" r="45" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="8"></circle>
                    <circle id="main-ring" cx="50" cy="50" r="45" fill="none" stroke="var(--accent)" stroke-width="8" stroke-dasharray="283" stroke-dashoffset="283" stroke-linecap="round" style="transition: 1s;"></circle>
                </svg>
                <div class="percentage-text">
                    <h2 id="total-perc">0%</h2>
                    <p style="font-size:0.6rem; color:#888;">OVERALL</p>
                </div>
            </div>
        </div>

        <h3 style="margin: 20px 0 15px; font-size: 0.9rem; color: #888; letter-spacing: 1px;">SUBJECT WISE ANALYSIS</h3>
        <div id="subject-list"></div>
    </div>
</div>

<script>
    const defaultSubjects = [
        "BET", "CHEMISTRY", "MATHS-II", "ENGLISH", 
        "CHEMISTRY LAB", "WS-II LAB-ME", "ENGLISH LAB", "BET LAB"
    ];

    let userProfile = JSON.parse(localStorage.getItem('at_profile')) || null;
    let subjects = JSON.parse(localStorage.getItem('at_subs_data')) || 
                   defaultSubjects.map(s => ({ name: s, p: 0, t: 0 }));

    window.onload = () => { if(userProfile) renderApp(); }

    function handlePhoto(input) {
        const file = input.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('preview-img').src = e.target.result;
                document.getElementById('preview-img').style.display = 'block';
                document.getElementById('upload-icon').style.display = 'none';
            };
            reader.readAsDataURL(file);
        }
    }

    function saveProfile() {
        const name = document.getElementById('nameIn').value;
        const roll = document.getElementById('rollIn').value;
        const sec = document.getElementById('secIn').value;
        const photo = document.getElementById('preview-img').src;

        if(!name || !roll || !sec) return alert("Please fill all details");

        userProfile = { name, roll, sec, photo };
        localStorage.setItem('at_profile', JSON.stringify(userProfile));
        renderApp();
    }

    function renderApp() {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('app-screen').style.display = 'block';
        
        document.getElementById('u-name-display').innerText = userProfile.name;
        document.getElementById('u-detail-display').innerText = `${userProfile.roll} â€¢ Section ${userProfile.sec}`;
        if(userProfile.photo) document.getElementById('u-photo-display').src = userProfile.photo;
        
        updateUI();
    }

    function mark(index, type) {
        subjects[index].t += 1;
        if(type === 'p') subjects[index].p += 1;
        localStorage.setItem('at_subs_data', JSON.stringify(subjects));
        updateUI();
    }

    function calculatePrediction(p, t) {
        const target = 0.75;
        if (t === 0) return "No data recorded yet.";
        let current = p / t;
        if (current >= target) {
            let canBunk = Math.floor((p - (target * t)) / target);
            return canBunk > 0 ? `âœ… Safe! You can bunk next <b>${canBunk}</b> classes.` : `âœ… On track! Don't bunk the next class.`;
        } else {
            let req = Math.ceil(((target * t) - p) / (1 - target));
            return `ðŸš¨ Warning! Attend next <b>${req}</b> classes for 75%.`;
        }
    }

    function updateUI() {
        const list = document.getElementById('subject-list');
        list.innerHTML = '';
        let totalP = 0, totalT = 0;

        subjects.forEach((s, i) => {
            totalP += s.p; totalT += s.t;
            const perc = s.t === 0 ? 0 : Math.round((s.p / s.t) * 100);
            const statusColor = perc < 75 ? 'var(--danger)' : 'var(--success)';

            list.innerHTML += `
                <div class="glass-card subject-card" style="border-left-color: ${statusColor}">
                    <div class="subject-header">
                        <div class="subject-name">${s.name}</div>
                        <div style="font-size:1.1rem; font-weight:900; color:${statusColor}">${perc}%</div>
                    </div>
                    <div style="font-size:0.7rem; color:#888; margin-bottom:12px;">
                        Attended: <b>${s.p}</b> | Total: <b>${s.t}</b>
                    </div>
                    <div class="btn-grid">
                        <button class="action-btn btn-p" onclick="mark(${i}, 'p')">PRESENT</button>
                        <button class="action-btn btn-a" onclick="mark(${i}, 'a')">ABSENT</button>
                        <button class="action-btn btn-b" onclick="mark(${i}, 'b')">BUNK</button>
                    </div>
                    <div class="prediction">${calculatePrediction(s.p, s.t)}</div>
                </div>`;
        });

        const overall = totalT === 0 ? 0 : Math.round((totalP / totalT) * 100);
        document.getElementById('total-perc').innerText = overall + "%";
        document.getElementById('main-ring').style.strokeDashoffset = 283 - (283 * overall) / 100;
        document.getElementById('main-ring').style.stroke = overall < 75 ? 'var(--danger)' : 'var(--success)';
    }

    function logout() {
        if(confirm("Erase all data and profile?")) {
            localStorage.clear();
            location.reload();
        }
    }
</script>
</body>
</html>