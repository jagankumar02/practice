<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Attendance Pro</title>
    <style>
        :root {
            --accent: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg: #030712;
            --card: rgba(17, 24, 39, 0.8);
        }

        body {
            background-color: var(--bg);
            background-image: radial-gradient(circle at 0% 0%, #1e1b4b 0%, transparent 40%),
                              radial-gradient(circle at 100% 100%, #111827 0%, transparent 40%);
            color: #f3f4f6;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            margin: 0; padding: 15px; min-height: 100vh;
        }

        .container { max-width: 450px; margin: auto; }

        /* --- Setup/Login Screen --- */
        .glass-modal {
            background: var(--card); backdrop-filter: blur(20px);
            padding: 35px 25px; border-radius: 32px; border: 1px solid rgba(255,255,255,0.1);
            margin-top: 40px; text-align: center; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
        }

        input[type="text"] {
            width: 100%; padding: 14px; margin-bottom: 12px; background: rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 14px; color: white; box-sizing: border-box;
        }

        .main-btn {
            width: 100%; padding: 16px; border: none; border-radius: 14px;
            background: linear-gradient(135deg, #6366f1, #a855f7); color: white;
            font-weight: 700; cursor: pointer; transition: 0.3s;
        }

        /* --- Dashboard UI --- */
        .glass-header {
            background: var(--card); backdrop-filter: blur(20px);
            padding: 20px; border-radius: 24px; border: 1px solid rgba(255,255,255,0.1);
            display: flex; align-items: center; gap: 15px; margin-bottom: 20px;
        }

        .user-img { width: 65px; height: 65px; border-radius: 50%; object-fit: cover; border: 2px solid var(--accent); }
        .user-initial { width: 65px; height: 65px; border-radius: 50%; background: var(--accent); display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; }

        .stats-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .stat-card { background: var(--card); padding: 15px; border-radius: 20px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }

        .planner-card {
            background: rgba(139, 92, 246, 0.1); border: 1px dashed var(--accent);
            padding: 15px; border-radius: 20px; margin-bottom: 20px; font-size: 0.85rem; text-align: center;
        }

        .target-bar {
            display: flex; justify-content: space-between; align-items: center;
            background: var(--card); padding: 10px 20px; border-radius: 15px; margin-bottom: 20px; font-size: 0.8rem;
        }

        /* --- Subject Cards --- */
        .subject-card {
            background: var(--card); border-radius: 24px; padding: 20px; margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.03); transition: 0.3s;
        }

        .progress-bg { height: 6px; background: rgba(255,255,255,0.05); border-radius: 10px; margin: 15px 0; overflow: hidden; }
        .progress-bar { height: 100%; transition: 0.8s ease-in-out; }

        .btn-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 15px; }
        .action-btn { border: none; padding: 10px; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 0.7rem; color: #fff; transition: 0.2s; }
        .btn-p { background: rgba(16, 185, 129, 0.15); color: var(--success); }
        .btn-a { background: rgba(239, 68, 68, 0.15); color: var(--danger); }
        .btn-b { background: rgba(245, 158, 11, 0.15); color: var(--warning); }
        .action-btn:active { transform: scale(0.9); }

        select { background: #1f2937; color: #fff; border: 1px solid #374151; border-radius: 8px; padding: 4px; }
    </style>
</head>
<body>

<div class="container">
    <div id="setup-screen">
        <div class="glass-modal">
            <h1 style="margin-bottom: 5px;">Elite Tracker</h1>
            <p style="color: #94a3b8; margin-bottom: 25px;">Professional Analytics for Students</p>
            
            <input type="file" id="photoFile" accept="image/*" hidden onchange="handleImg(this)">
            <div onclick="document.getElementById('photoFile').click()" style="margin-bottom: 15px; cursor: pointer;">
                <div id="imgPlaceholder" style="width: 80px; height: 80px; background: #1f2937; border-radius: 50%; margin: auto; display: flex; align-items: center; justify-content: center; border: 2px dashed var(--accent);">ðŸ“¸</div>
            </div>

            <input type="text" id="nameIn" placeholder="Enter Full Name">
            <input type="text" id="classIn" placeholder="Class (e.g. B.Tech 2nd Year)">
            <input type="text" id="rollIn" placeholder="Roll Number">
            <button class="main-btn" onclick="saveUser()">Start Professional Dashboard</button>
        </div>
    </div>

    <div id="app-screen" style="display: none;">
        <div class="glass-header">
            <div id="userPhotoBox"></div>
            <div>
                <h3 id="userName" style="margin: 0; font-size: 1.1rem;">User Name</h3>
                <p id="userMeta" style="margin: 2px 0 0; font-size: 0.75rem; color: #94a3b8;">Class â€¢ Roll</p>
            </div>
            <button onclick="logout()" style="margin-left: auto; background: none; border: none; color: var(--danger); font-size: 0.7rem; font-weight: bold; cursor: pointer;">LOGOUT</button>
        </div>

        <div class="target-bar">
            <span>ðŸŽ¯ Set Target Attendance:</span>
            <select id="targetSel" onchange="renderApp()">
                <option value="75">75%</option>
                <option value="80" selected>80%</option>
                <option value="85">85%</option>
                <option value="90">90%</option>
            </select>
        </div>

        <div class="stats-row">
            <div class="stat-card">
                <span id="overallP" style="font-size: 1.6rem; font-weight: 800; display: block;">0%</span>
                <span style="font-size: 0.6rem; color: #6b7280; text-transform: uppercase;">Overall</span>
            </div>
            <div class="stat-card">
                <span id="totalB" style="font-size: 1.6rem; font-weight: 800; display: block; color: var(--warning);">0</span>
                <span style="font-size: 0.6rem; color: #6b7280; text-transform: uppercase;">Bunks</span>
            </div>
        </div>

        <div class="planner-card" id="plannerMsg">Calculating your status...</div>

        <div id="list"></div>
    </div>
</div>

<script>
    const subjects = ["Mathematics", "Physics", "Chemistry", "Comp. Science", "Data Structures", "Web Development"];
    let userImgData = "";

    window.onload = () => { if(localStorage.getItem('pro_user')) startDashboard(); }

    function handleImg(input) {
        const reader = new FileReader();
        reader.onload = (e) => {
            userImgData = e.target.result;
            document.getElementById('imgPlaceholder').innerHTML = `<img src="${userImgData}" style="width:100%; height:100%; border-radius:50%; object-fit:cover;">`;
        };
        reader.readAsDataURL(input.files[0]);
    }

    function saveUser() {
        const user = {
            name: document.getElementById('nameIn').value,
            class: document.getElementById('classIn').value,
            roll: document.getElementById('rollIn').value,
            img: userImgData
        };
        if(!user.name || !user.class) return alert("Fill Name & Class!");
        localStorage.setItem('pro_user', JSON.stringify(user));
        startDashboard();
    }

    function startDashboard() {
        document.getElementById('setup-screen').style.display = 'none';
        document.getElementById('app-screen').style.display = 'block';
        const user = JSON.parse(localStorage.getItem('pro_user'));
        
        document.getElementById('userName').innerText = user.name;
        document.getElementById('userMeta').innerText = `${user.class} â€¢ Roll: ${user.roll}`;
        document.getElementById('userPhotoBox').innerHTML = user.img ? 
            `<img src="${user.img}" class="user-img">` : 
            `<div class="user-initial">${user.name[0]}</div>`;
        
        renderApp();
    }

    function renderApp() {
        const data = JSON.parse(localStorage.getItem('pro_data')) || {};
        const container = document.getElementById('list');
        const target = parseInt(document.getElementById('targetSel').value);
        container.innerHTML = '';
        
        let tP = 0, tT = 0, tB = 0;

        subjects.forEach(s => {
            if(!data[s]) data[s] = {p:0, a:0, b:0, t:0};
            const {p, a, b, t} = data[s];
            tP += p; tT += t; tB += b;
            
            const perc = t === 0 ? 0 : ((p/t)*100).toFixed(1);
            const color = perc < target ? 'var(--danger)' : 'var(--success)';

            container.innerHTML += `
                <div class="subject-card">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span style="font-weight:700;">${s}</span>
                        <span style="color:${color}; font-weight:800;">${perc}%</span>
                    </div>
                    <div class="progress-bg"><div class="progress-bar" style="width:${perc}%; background:${color}"></div></div>
                    <div style="font-size:0.7rem; color:#6b7280">P: ${p} | A: ${a} | Bunks: ${b} | Total: ${t}</div>
                    <div class="btn-grid">
                        <button class="action-btn btn-p" onclick="mark('${s}','p')">PRESENT</button>
                        <button class="action-btn btn-a" onclick="mark('${s}','a')">ABSENT</button>
                        <button class="action-btn btn-b" onclick="mark('${s}','b')">BUNK</button>
                    </div>
                </div>`;
        });

        const overall = tT === 0 ? 0 : ((tP/tT)*100).toFixed(1);
        document.getElementById('overallP').innerText = overall + "%";
        document.getElementById('overallP').style.color = overall < target ? 'var(--danger)' : 'var(--success)';
        document.getElementById('totalB').innerText = tB;
        
        updatePlanner(tP, tT, target);
    }

    function updatePlanner(p, t, target) {
        const msg = document.getElementById('plannerMsg');
        if(t === 0) return msg.innerHTML = "ðŸ’¡ Pehli class mark karo!";
        
        let currentPerc = (p/t)*100;
        if(currentPerc < target) {
            let req = 0, tempP = p, tempT = t;
            while((tempP/tempT)*100 < target) { tempP++; tempT++; req++; }
            msg.innerHTML = `âš ï¸ <b>Below Target!</b> Agle <b>${req}</b> classes attend karo to hit ${target}%`;
            msg.style.color = "var(--danger)";
        } else {
            let canBunk = 0, tempT = t;
            while(((p)/(tempT+1))*100 >= target) { tempT++; canBunk++; }
            msg.innerHTML = canBunk > 0 ? `âœ… <b>Safe!</b> You can bunk next <b>${canBunk}</b> classes.` : `âš¡ <b>Borderline!</b> Agli class miss mat karna.`;
            msg.style.color = "var(--success)";
        }
    }

    function mark(s, type) {
        let data = JSON.parse(localStorage.getItem('pro_data')) || {};
        if(!data[s]) data[s] = {p:0, a:0, b:0, t:0};
        data[s].t += 1;
        data[s][type] += 1;
        localStorage.setItem('pro_data', JSON.stringify(data));
        renderApp();
    }

    function logout() {
        if(confirm("Logout? Saara data (Photo/Attendance) delete ho jayega.")) {
            localStorage.clear();
            location.reload();
        }
    }
</script>
</body>
</html>